(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.reg.get("core","admin/app");var a=t.n(e);const s=flarum.reg.get("core","common/components/Button");var n=t.n(s);const r=flarum.reg.get("core","common/models/Group");var o=t.n(r);const l=flarum.reg.get("core","common/helpers/textContrastClass");var i=t.n(l);const d="yippy-auth-ldap",c="yippy-auth-ldap.admin.settings.",p=d+".domains",u=["cn","commonName","displayName","name","title","personalTitle","givenName","initials","sn","surname"],h=["mail","rfc822Mailbox "],g=["mailNickname","sAMAccountName","uid","userPrincipalName"],f=["mailNickname","sAMAccountName","uid","userPrincipalName","mail","rfc822Mailbox "],y=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]);for(let a=0;a<e.length;a++)t.indexOf(e[a])>0&&t.splice(a,0,t.splice(t.indexOf(e[a]),1)[0]);return t};a().initializers.add(d,(()=>{a().registry.for(d).registerSetting({setting:d+".method_name",label:a().translator.trans(c+"method_name"),type:"text",placeholder:"YunoHost"}).registerSetting((function(){let t;try{t=JSON.parse(this.setting(p)())}catch(t){}Array.isArray(t)||(t=[]);let e=a().store.all("groups").filter((t=>t.id()!==o().MEMBER_ID&&t.id()!==o().GUEST_ID)),s=[];e.forEach((t=>{let e={id:t.data.id,text:t.data.attributes.namePlural,color:t.data.attributes.color,icon:t.data.attributes.icon,isHidden:t.data.attributes.isHidden,namePlural:t.data.attributes.namePlural,nameSingular:t.data.attributes.nameSingular};s.push(e)}));let r={results:s};return m(".Form-group",[m("label",a().translator.trans(c+"domains.title")),m(".helpText",a().translator.trans(c+"domains.description")),m("table",{style:"table-layout:fixed;color:#000000;"},[m("tbody",[t.map(((e,s)=>m("table",{border:"1px solid black",style:e.isEnabled||null==e.isEnabled?"background-color: #ffffff":"background-color: #F88379"},[m("thead",m("tr",[m("th",a().translator.trans(c+"domains.banner",{index:s+1,isEnabled:e.isEnabled||null==e.isEnabled?a().translator.trans(c+"domains.is_enabled.enabled"):a().translator.trans(c+"domains.is_enabled.disabled")})),m("th",n().component({className:"Button Button--icon",icon:"fas fa-times",onclick:()=>{t.splice(s,1),this.setting(p)(t.length>0?JSON.stringify(t):"")}}))])),m("tbody",[m("table",[m("thead",m("tr",[m("th",{width:"30%"}),m("th",{width:"70%"})])),m("tbody",[m("tr",[m("th",{colspan:2},a().translator.trans(c+"domains.header.server"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.host")),m("td",m("input.FormControl",{type:"text",style:"background-color:#e8ecf2;color:#000000",value:e.host||"",placeholder:"localhost",onchange:a=>{e.host=a.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.host_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.port")),m("td",m("input.FormControl",{type:"number",style:"background-color:#e8ecf2;color:#000000",value:e.port||389,placeholder:"389",onchange:a=>{e.port=Number(a.target.value),this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.port_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.version")),m("td",m("input.FormControl",{type:"number",style:"background-color:#e8ecf2;color:#000000",value:e.version||3,placeholder:"3",onchange:a=>{e.version=Number(a.target.value),this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.version_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.base_dn")),m("td",m("input.FormControl",{type:"text",style:"background-color:#e8ecf2;color:#000000",value:e.baseDN||"",placeholder:"ou=users,dc=yunohost,dc=org",onchange:a=>{e.baseDN=a.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.base_dn_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.filter")),m("td",m("input.FormControl",{type:"text",style:"background-color:#e8ecf2;color:#000000",value:e.filter||"",placeholder:"(&(objectClass=posixAccount)(permission=cn=flarum.main,ou=permission,dc=yunohost,dc=org)",onchange:a=>{e.filter=a.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.filter_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.follow_referrals")),m("td",m("input",{type:"checkbox",checked:e.followReferrals,onchange:a=>{e.followReferrals=a.target.checked,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",a().translator.trans(c+"domains.data.use_ssl")),m("td",m("input",{type:"checkbox",checked:e.useSSL,onchange:a=>{e.useSSL=a.target.checked,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",a().translator.trans(c+"domains.data.use_tls")),m("td",m("input",{type:"checkbox",checked:e.useTLS,onchange:a=>{e.useTLS=a.target.checked,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("th",{colspan:2},a().translator.trans(c+"domains.header.admin"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.admin_dn")),m("td",m("input.FormControl",{type:"text",style:"background-color:#e8ecf2;color:#000000",value:e.admin.dn||"",placeholder:"cn=admin,dc=yunohost,dc=org",onchange:a=>{e.admin.dn=a.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.admin_dn_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.admin_password")),m("td",m("input.FormControl",{type:"text",style:"background-color:#e8ecf2;color:#000000",value:e.admin.password||"",placeholder:"password",onchange:a=>{e.admin.password=a.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.admin_password_help"))]),m("tr",[m("th",{colspan:2},a().translator.trans(c+"domains.header.search_fields"))]),m("tr",[m("td",{colspan:2},a().translator.trans(c+"domains.header.search_fields_description"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.search_user_fields")),m("td",m("select",{oncreate:t=>{let{dom:a}=t;return $(a).select2({width:"100%",multiple:!0,data:y(f,e.searchFields),templateResult:t=>'<span style="color:#000000;">'+(t.text+"</span>"),escapeMarkup:t=>t}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:$(this).val()}))})).on("select2:select",(function(t){var e=t.params.data.id,a=$(t.target).children("[value="+e+"]");a.detach(),$(t.target).append(a).change()})).val(e.searchFields||[]).trigger("change")},onedit:a=>{e.searchFields=a.detail,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.search_user_fields_help"))]),m("tr",[m("th",{colspan:2},a().translator.trans(c+"domains.header.flarum"))]),m("tr",[m("td",{colspan:2},a().translator.trans(c+"domains.header.flarum_description"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.user_username")),m("td",m("select",{value:e.user.username||"",oncreate:t=>{let{dom:e}=t;return $(e).select2({width:"100%",allowClear:!0,placeholder:"",templateResult:t=>'<span style="color:#000000;">'+(t.text+"</span>"),escapeMarkup:t=>t}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:this.value}))}))},onedit:a=>{e.user.username=a.detail,this.setting(p)(JSON.stringify(t))}},[g.map((t=>[m("option",{value:t},t)]))]))]),m("tr",[m("td",a().translator.trans(c+"domains.data.user_mail")),m("td",m("select",{value:e.user.mail||"",oncreate:t=>{let{dom:e}=t;return $(e).select2({width:"100%",allowClear:!0,placeholder:"",templateResult:t=>'<span style="color:#000000;">'+(t.text+"</span>"),escapeMarkup:t=>t}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:this.value}))}))},onedit:a=>{e.user.mail=a.detail,this.setting(p)(JSON.stringify(t))}},[h.map((t=>[m("option",{value:t},t)]))]))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.user_mail_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.user_nickname_fields")),m("td",m("select",{oncreate:t=>{let{dom:a}=t;return $(a).select2({width:"100%",multiple:!0,data:y(u,e.user.nicknameFields),templateResult:t=>'<span style="color:#000000;">'+(t.text+"</span>"),escapeMarkup:t=>t}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:$(this).val()}))})).on("select2:select",(function(t){var e=t.params.data.id,a=$(t.target).children("[value="+e+"]");a.detach(),$(t.target).append(a).change()})).val(e.user.nicknameFields||[]).trigger("change")},onedit:a=>{e.user.nicknameFields=a.detail,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.user_nickname_fields_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.permission_groups")),m("td",m("select",{oncreate:t=>{let{dom:a}=t;return $(a).select2({templateResult:t=>{var e='<span style="color:#000000;">';return t.icon&&(e+='<i class="fa fa-lg '+t.icon.toLowerCase()+'"></i> '),e+(t.text+"</span>")},templateSelection:t=>{var e='<span style="padding: 5px 10px 5px 10px; background-color:'+t.color+';" class="'+i()(t.color)+'">';return t.icon&&(e+='<i class="fa fa-lg '+t.icon.toLowerCase()+'"></i> '),e+(t.text+"</span>")},escapeMarkup:t=>t,width:"100%",multiple:!0,data:$.map(r,(function(t){return t.text=t.text||t.name,t}))}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:$(this).val()}))})).on("select2:select",(function(t){var e=t.params.data.id,a=$(t.target).children("[value="+e+"]");a.detach(),$(t.target).append(a).change()})).val(e.permission&&e.permission.groups||[]).trigger("change")},onedit:a=>{e.permission?e.permission.groups=a.detail:e.permission={groups:a.detail},this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},a().translator.trans(c+"domains.data.permission_groups_help"))]),m("tr",[m("td",a().translator.trans(c+"domains.data.is_enabled")),m("td",m("input",{type:"checkbox",checked:e.isEnabled||null==e.isEnabled,onchange:a=>{e.isEnabled=a.target.checked,this.setting(p)(JSON.stringify(t))}}))])])])])]))),m("tr",m("td",n().component({className:"Button Button--block",onclick:()=>{t.push({host:"",port:389,version:3,baseDN:"",filter:"",admin:{dn:"",password:""},searchFields:[],user:{username:"",mail:"",nicknameFields:[]},permission:{groups:[]},followReferrals:!1,useSSL:!1,useTLS:!1,isEnabled:!0}),this.setting(p)(JSON.stringify(t))}},a().translator.trans(c+"domains.add"))))])])])})).registerSetting({setting:d+".onlyUse",label:a().translator.trans(c+"onlyUse"),type:"boolean",default:!1}).registerSetting({setting:d+".display_detailed_error",label:a().translator.trans(c+"display_detailed_error"),type:"boolean",default:!1})}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map