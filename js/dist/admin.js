(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var n in e)t.o(e,n)&&!t.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:e[n]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};(()=>{"use strict";const a=flarum.reg.get("core","admin/app");var e=t.n(a);const n=flarum.reg.get("core","common/components/Button");var s=t.n(n);const r=flarum.reg.get("core","common/models/Group");var i=t.n(r);const l=flarum.reg.get("core","common/helpers/textContrastClass");var o=t.n(l);const d="yippy-auth-ldap",c="yippy-auth-ldap.admin.settings.",p=d+".domains",u=["cn","commonName","displayName","name","title","personalTitle","givenName","initials","sn","surname"],h=["mail","rfc822Mailbox "],g=["mailNickname","sAMAccountName","uid","userPrincipalName"],f=["mailNickname","sAMAccountName","uid","userPrincipalName","mail","rfc822Mailbox "],v=function(t,a){void 0===t&&(t=[]),void 0===a&&(a=[]);for(let e=0;e<a.length;e++)t.indexOf(a[e])>0&&t.splice(e,0,t.splice(t.indexOf(a[e]),1)[0]);return t};e().initializers.add(d,(()=>{e().registry.for(d).registerSetting({setting:d+".method_name",label:e().translator.trans(c+"method_name"),type:"text",placeholder:"YunoHost"}).registerSetting((function(){let t;try{t=JSON.parse(this.setting(p)())}catch(t){}Array.isArray(t)||(t=[]);let a=e().store.all("groups").filter((t=>t.id()!==i().MEMBER_ID&&t.id()!==i().GUEST_ID)),n=[];a.forEach((t=>{let a={id:t.data.id,text:t.data.attributes.namePlural,color:t.data.attributes.color,icon:t.data.attributes.icon,isHidden:t.data.attributes.isHidden,namePlural:t.data.attributes.namePlural,nameSingular:t.data.attributes.nameSingular};n.push(a)}));let r={results:n};return m(".Form-group",[m("label",e().translator.trans(c+"domains.title")),m(".helpText",e().translator.trans(c+"domains.description")),m("table",{style:"table-layout:fixed"},[m("tbody",[t.map(((a,n)=>m("table",{border:"1px solid black",style:a.isEnabled||null==a.isEnabled?"background-color: #ffffff":"background-color: #F88379"},[m("thead",m("tr",[m("th",e().translator.trans(c+"domains.banner",{index:n+1,isEnabled:a.isEnabled||null==a.isEnabled?e().translator.trans(c+"domains.is_enabled.enabled"):e().translator.trans(c+"domains.is_enabled.disabled")})),m("th",s().component({className:"Button Button--icon",icon:"fas fa-times",onclick:()=>{t.splice(n,1),this.setting(p)(t.length>0?JSON.stringify(t):"")}}))])),m("tbody",[m("table",[m("thead",m("tr",[m("th",{width:"30%"}),m("th",{width:"70%"})])),m("tbody",[m("tr",[m("th",{colspan:2},e().translator.trans(c+"domains.header.server"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.host")),m("td",m("input.FormControl",{type:"text",value:a.host||"",placeholder:"localhost",onchange:e=>{a.host=e.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.host_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.port")),m("td",m("input.FormControl",{type:"number",value:a.port||389,placeholder:"389",onchange:e=>{a.port=Number(e.target.value),this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.port_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.version")),m("td",m("input.FormControl",{type:"number",value:a.version||3,placeholder:"3",onchange:e=>{a.version=Number(e.target.value),this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.version_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.base_dn")),m("td",m("input.FormControl",{type:"text",value:a.baseDN||"",placeholder:"ou=users,dc=yunohost,dc=org",onchange:e=>{a.baseDN=e.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.base_dn_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.filter")),m("td",m("input.FormControl",{type:"text",value:a.filter||"",placeholder:"(&(objectClass=posixAccount)(permission=cn=flarum.main,ou=permission,dc=yunohost,dc=org)",onchange:e=>{a.filter=e.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.filter_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.follow_referrals")),m("td",m("input",{type:"checkbox",checked:a.followReferrals,onchange:e=>{a.followReferrals=e.target.checked,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",e().translator.trans(c+"domains.data.use_ssl")),m("td",m("input",{type:"checkbox",checked:a.useSSL,onchange:e=>{a.useSSL=e.target.checked,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",e().translator.trans(c+"domains.data.use_tls")),m("td",m("input",{type:"checkbox",checked:a.useTLS,onchange:e=>{a.useTLS=e.target.checked,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("th",{colspan:2},e().translator.trans(c+"domains.header.admin"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.admin_dn")),m("td",m("input.FormControl",{type:"text",value:a.admin.dn||"",placeholder:"cn=admin,dc=yunohost,dc=org",onchange:e=>{a.admin.dn=e.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.admin_dn_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.admin_password")),m("td",m("input.FormControl",{type:"text",value:a.admin.password||"",placeholder:"password",onchange:e=>{a.admin.password=e.target.value,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.admin_password_help"))]),m("tr",[m("th",{colspan:2},e().translator.trans(c+"domains.header.search_fields"))]),m("tr",[m("td",{colspan:2},e().translator.trans(c+"domains.header.search_fields_description"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.search_user_fields")),m("td",m("select",{oncreate:t=>{let{dom:e}=t;return $(e).select2({width:"100%",multiple:!0,data:v(f,a.searchFields)}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:$(this).val()}))})).on("select2:select",(function(t){var a=t.params.data.id,e=$(t.target).children("[value="+a+"]");e.detach(),$(t.target).append(e).change()})).val(a.searchFields||[]).trigger("change")},onedit:e=>{a.searchFields=e.detail,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.search_user_fields_help"))]),m("tr",[m("th",{colspan:2},e().translator.trans(c+"domains.header.flarum"))]),m("tr",[m("td",{colspan:2},e().translator.trans(c+"domains.header.flarum_description"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.user_username")),m("td",m("select",{value:a.user.username||"",oncreate:t=>{let{dom:a}=t;return $(a).select2({width:"100%",allowClear:!0,placeholder:""}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:this.value}))}))},onedit:e=>{a.user.username=e.detail,this.setting(p)(JSON.stringify(t))}},[g.map((t=>[m("option",{value:t},t)]))]))]),m("tr",[m("td",e().translator.trans(c+"domains.data.user_mail")),m("td",m("select",{value:a.user.mail||"",oncreate:t=>{let{dom:a}=t;return $(a).select2({width:"100%",allowClear:!0,placeholder:""}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:this.value}))}))},onedit:e=>{a.user.mail=e.detail,this.setting(p)(JSON.stringify(t))}},[h.map((t=>[m("option",{value:t},t)]))]))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.user_mail_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.user_nickname_fields")),m("td",m("select",{oncreate:t=>{let{dom:e}=t;return $(e).select2({width:"100%",multiple:!0,data:v(u,a.user.nicknameFields)}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:$(this).val()}))})).on("select2:select",(function(t){var a=t.params.data.id,e=$(t.target).children("[value="+a+"]");e.detach(),$(t.target).append(e).change()})).val(a.user.nicknameFields||[]).trigger("change")},onedit:e=>{a.user.nicknameFields=e.detail,this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.user_nickname_fields_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.permission_groups")),m("td",m("select",{oncreate:t=>{let{dom:e}=t;return $(e).select2({templateResult:t=>{var a="<span>";return t.icon&&(a+='<i class="fa fa-lg '+t.icon.toLowerCase()+'"></i> '),a+(t.text+"</span>")},templateSelection:t=>{var a='<span style="padding: 5px 10px 5px 10px; background-color:'+t.color+';" class="'+o()(t.color)+'">';return t.icon&&(a+='<i class="fa fa-lg '+t.icon.toLowerCase()+'"></i> '),a+(t.text+"</span>")},escapeMarkup:t=>t,width:"100%",multiple:!0,data:$.map(r,(function(t){return t.text=t.text||t.name,t}))}).on("change",(function(){this.dispatchEvent(new CustomEvent("edit",{detail:$(this).val()}))})).on("select2:select",(function(t){var a=t.params.data.id,e=$(t.target).children("[value="+a+"]");e.detach(),$(t.target).append(e).change()})).val(a.permission&&a.permission.groups||[]).trigger("change")},onedit:e=>{a.permission?a.permission.groups=e.detail:a.permission={groups:e.detail},this.setting(p)(JSON.stringify(t))}}))]),m("tr",[m("td",{colspan:2,class:"helpText"},e().translator.trans(c+"domains.data.permission_groups_help"))]),m("tr",[m("td",e().translator.trans(c+"domains.data.is_enabled")),m("td",m("input",{type:"checkbox",checked:a.isEnabled||null==a.isEnabled,onchange:e=>{a.isEnabled=e.target.checked,this.setting(p)(JSON.stringify(t))}}))])])])])]))),m("tr",m("td",s().component({className:"Button Button--block",onclick:()=>{t.push({host:"",port:389,version:3,baseDN:"",filter:"",admin:{dn:"",password:""},searchFields:[],user:{username:"",mail:"",nicknameFields:[]},permission:{groups:[]},followReferrals:!1,useSSL:!1,useTLS:!1,isEnabled:!0}),this.setting(p)(JSON.stringify(t))}},e().translator.trans(c+"domains.add"))))])])])})).registerSetting({setting:d+".onlyUse",label:e().translator.trans(c+"onlyUse"),type:"boolean",default:!1}).registerSetting({setting:d+".display_detailed_error",label:e().translator.trans(c+"display_detailed_error"),type:"boolean",default:!1})}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map